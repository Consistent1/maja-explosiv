{# Featured Projects Section #}
{% set featuredData = featuredProjects %}
{% if featuredData and featuredData.featured and featuredData.featured.length > 0 %}
<section class="featured-projects-section">
  <div class="featured-projects-container">
    <div class="featured-projects-grid">
      {# Split projects into two columns #}
      {% set leftColumn = [] %}
      {% set rightColumn = [] %}
      
      {# Process all projects first to build the arrays #}
      {% for item in featuredData.featured %}
        {# Find the project in collections #}
        {% set projectFound = false %}
        {% set projectPost = null %}
        {% set projectImage = null %}
        {% set errorMessage = null %}
        
        {# Search through all collections to find the project #}
        {% for collectionName in ['sculptures', 'installations', 'performance', 'paintings'] %}
          {% if not projectFound %}
            {% for post in collections[collectionName] %}
              {% set postSlug = post.fileSlug %}
              {% set postPath = post.inputPath | replace("./src/posts/projects/", "") | replace(".md", "") %}
              
              {# Check if this is the project we're looking for #}
              {% if postPath == item.slug or (collectionName + '/' + postSlug) == item.slug %}
                {% set projectFound = true %}
                {% set projectPost = post %}
                
                {# Determine which image to use #}
                {% if item.image %}
                  {# Use the override image from data file #}
                  {% set projectImage = item.image %}
                {% elif post.data.featuredImage %}
                  {# Use the project's featured image #}
                  {% set projectImage = post.data.featuredImage %}
                {% elif post.data.images and post.data.images.length > 0 %}
                  {# Use the first image from the images array #}
                  {% set projectImage = post.data.images[0].src %}
                {% else %}
                  {# No image available #}
                  {% set errorMessage = "ERROR: Project '" + item.slug + "' found but has no images. Please add a featuredImage or images array to the project, or specify an image override in featuredProjects.json" %}
                {% endif %}
              {% endif %}
            {% endfor %}
          {% endif %}
        {% endfor %}
        
        {# Distribute projects between columns (odd indexes to left, even to right) #}
        {% if loop.index0 % 2 == 0 %}
          {% set _ = leftColumn.push({found: projectFound, post: projectPost, image: projectImage, error: errorMessage, item: item}) %}
        {% else %}
          {% set _ = rightColumn.push({found: projectFound, post: projectPost, image: projectImage, error: errorMessage, item: item}) %}
        {% endif %}
      {% endfor %}
      
      {# Left Column #}
      <div class="featured-projects-column">
        {% for project in leftColumn %}
          {% if project.found %}
            {% if project.image %}
              <div class="featured-project-item">
                <a href="{{ project.post.url | url }}" class="featured-project-link">
                  <div class="featured-project-image-wrapper">
                    {# Determine image-specific metadata from featuredProjects.json or image array #}
                    {% set imageData = null %}
                    {% if project.post.data.images and project.post.data.images.length > 0 %}
                      {# Find the matching image data if using images array #}
                      {% for img in project.post.data.images %}
                        {% if img.src == project.image %}
                          {% set imageData = img %}
                        {% endif %}
                      {% endfor %}
                    {% endif %}
                    
                    {# Determine alt text: use image alt, or fallback to project title #}
                    {% set altText = project.post.data.title %}
                    {% if imageData and imageData.alt %}
                      {% set altText = imageData.alt %}
                    {% endif %}
                    
                    <img 
                      src="{{ project.image | url }}" 
                      alt="{{ altText }}"
                      class="featured-project-image"
                      loading="lazy"
                    >
                  </div>
                </a>
                
                {# Use project-image-caption template with project title/year and image description/author #}
                {% set projectTitle = project.post.data.title %}
                {% set projectYear = project.post.data.date | date('YYYY') if project.post.data.date else '' %}
                {% set imageDescription = imageData.description if imageData else '' %}
                {% set imageAuthor = imageData.author if imageData else '' %}
                {% set projectSlug = project.item.slug %}
                {% set context = "featured-projects" %}
                {% include "project-image-caption.njk" %}
              </div>
            {% else %}
              {# Log error to console but don't display on page #}
              {% set _ = project.error | log %}
            {% endif %}
          {% else %}
            {# Log error to console but don't display on page #}
            {% set notFoundError = "ERROR: Featured project '" + project.item.slug + "' not found in any collection. Please check the slug in featuredProjects.json matches the project path (e.g., 'sculptures/project-name')" %}
            {% set _ = notFoundError | log %}
          {% endif %}
        {% endfor %}
      </div>
      
      {# Right Column #}
      <div class="featured-projects-column">
        {% for project in rightColumn %}
          {% if project.found %}
            {% if project.image %}
              <div class="featured-project-item">
                <a href="{{ project.post.url | url }}" class="featured-project-link">
                  <div class="featured-project-image-wrapper">
                    {# Determine image-specific metadata from featuredProjects.json or image array #}
                    {% set imageData = null %}
                    {% if project.post.data.images and project.post.data.images.length > 0 %}
                      {# Find the matching image data if using images array #}
                      {% for img in project.post.data.images %}
                        {% if img.src == project.image %}
                          {% set imageData = img %}
                        {% endif %}
                      {% endfor %}
                    {% endif %}
                    
                    {# Determine alt text: use image alt, or fallback to project title #}
                    {% set altText = project.post.data.title %}
                    {% if imageData and imageData.alt %}
                      {% set altText = imageData.alt %}
                    {% endif %}
                    
                    <img 
                      src="{{ project.image | url }}" 
                      alt="{{ altText }}"
                      class="featured-project-image"
                      loading="lazy"
                    >
                  </div>
                </a>
                
                {# Use project-image-caption template with project title/year and image description/author #}
                {% set projectTitle = project.post.data.title %}
                {% set projectYear = project.post.data.date | date('YYYY') if project.post.data.date else '' %}
                {% set imageDescription = imageData.description if imageData else '' %}
                {% set imageAuthor = imageData.author if imageData else '' %}
                {% set projectSlug = project.item.slug %}
                {% set context = "featured-projects" %}
                {% include "project-image-caption.njk" %}
              </div>
            {% else %}
              {# Log error to console but don't display on page #}
              {% set _ = project.error | log %}
            {% endif %}
          {% else %}
            {# Log error to console but don't display on page #}
            {% set notFoundError = "ERROR: Featured project '" + project.item.slug + "' not found in any collection. Please check the slug in featuredProjects.json matches the project path (e.g., 'sculptures/project-name')" %}
            {% set _ = notFoundError | log %}
          {% endif %}
        {% endfor %}
      </div>
    </div>
  </div>
</section>
{% endif %}
