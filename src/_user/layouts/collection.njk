---
layout: sidebar-layout.njk
---
{# User override for collection layout - ensures sidebar appears on all collection pages #}

<div class="collection-page">
    <!-- Collection Header -->
    {% set posts = collections.allPosts | getPostsByCollection(collectionName) %}
    {% set collectionData = collections.collectionData | find('name', collectionName) %}
    <header class="collection-header">
        {% if collectionData and collectionData.featuredImage %}
            <div class="collection-hero" style="background-image: url('{{ collectionData.featuredImage | url }}');">
                <div class="collection-hero-content">
                    <h1 class="collection-title">{{ collectionData.displayName or (collectionName | title) }}</h1>
                    {% if collectionData.description %}
                        <p class="collection-description">{{ collectionData.description }}</p>
                    {% endif %}
                </div>
            </div>
        {% else %}
            <div class="collection-header-simple">
                <h1 class="collection-title">{{ collectionData.displayName or (collectionName | title) }}</h1>
                {% if collectionData.description %}
                    <p class="collection-description">{{ collectionData.description }}</p>
                {% endif %}
            </div>
        {% endif %}

        <div class="collection-meta">
            <span class="post-count">{{ posts.length }} post{{ 's' if posts.length != 1 }}</span>
            {% if collectionData and collectionData.parentCollection %}
                <a href="{{ ('/collections/' + (collectionData.parentCollection | slug) + '/') | url }}" class="parent-collection">
                    ‚Üê Back to {{ collectionData.parentCollection | title }}
                </a>
            {% endif %}
        </div>
    </header>

    <!-- Collection Content -->
    <div class="collection-content">
        {% if posts.length > 0 %}
            <div class="posts-grid">
                {% for post in posts %}
                    <article class="post-card">
                        {# Determine which image to display: featuredImage or first image from images array #}
                        {% set displayImage = post.data.featuredImage %}
                        {% if not displayImage and post.data.images and post.data.images.length > 0 %}
                            {% set displayImage = post.data.images[0].src %}
                        {% endif %}
                        
                        {% if displayImage %}
                            <a href="{{ post.url | url }}" class="post-card-image-link">
                                {# Determine image metadata for caption #}
                                {% set imageData = null %}
                                {% if post.data.images and post.data.images.length > 0 %}
                                  {# Find the image data matching display image #}
                                  {% for img in post.data.images %}
                                    {% if img.src == displayImage %}
                                      {% set imageData = img %}
                                    {% endif %}
                                  {% endfor %}
                                {% endif %}
                                
                                {# Determine alt text: use image alt, or fallback to post title #}
                                {% set altText = post.data.title %}
                                {% if imageData and imageData.alt %}
                                  {% set altText = imageData.alt %}
                                {% elif post.data.featuredImageAlt %}
                                  {% set altText = post.data.featuredImageAlt %}
                                {% endif %}
                                
                                <img src="{{ displayImage | url }}" alt="{{ altText }}" class="post-card-image">
                            </a>
                            
                            {# Use project-image-caption template with project title/year and image description/author #}
                            {% set projectTitle = post.data.title %}
                            {% set projectYear = post.data.date | date('YYYY') if post.data.date else '' %}
                            {% set imageDescription = imageData.description if imageData else '' %}
                            {% set imageAuthor = imageData.author if imageData else '' %}
                            {% set projectSlug = post.fileSlug %}
                            {% set context = "collection-" + collectionName %}
                            {% include "project-image-caption.njk" %}
                        {% endif %}
                        
                        <div class="post-card-content">
                            <h3 class="post-card-title">
                                <a href="{{ post.url | url }}">{{ post.data.title }}</a>
                            </h3>
                            
                            {% if post.data.description or post.data.excerpt %}
                                <p class="post-card-excerpt">{{ post.data.description or post.data.excerpt }}</p>
                            {% endif %}
                            
                            <div class="post-card-meta">
                                {% if post.data.date %}
                                    <time datetime="{{ post.data.date | date('YYYY-MM-DD') }}">
                                        {{ post.data.date | dateDisplay }}
                                    </time>
                                {% endif %}
                            </div>
                        </div>
                    </article>
                {% endfor %}
            </div>
        {% else %}
            <p class="no-posts">No posts in this collection yet.</p>
        {% endif %}
    </div>
</div>
