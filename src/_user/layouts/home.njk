---
layout: sidebar-layout.njk
---

<div class="home-page">
    {% if hero %}
        <section class="hero-section">
            {% if hero.backgroundImage %}
                <div class="hero-background" style="background-image: url('{{ hero.backgroundImage | url }}');">
            {% else %}
                <div class="hero-background">
            {% endif %}
                <div class="hero-content">
                    {% if hero.title %}
                        <h1 class="hero-title">
                            <span class="d-block">{{ hero.title }}</span>
                            {% if hero.subtitle %}
                                <span class="d-block">{{ hero.subtitle }}</span>
                            {% endif %}
                        </h1>
                    {% endif %}
                    {% if hero.description %}
                        <div class="hero-description">
                            {{ hero.description | safe }}
                        </div>
                    {% endif %}
                    {% if hero.ctaButton %}
                        <div class="hero-cta">
                            <a href="{{ hero.ctaButton.url | url }}" class="cta-button">
                                <span class="arrow-icon">â†—</span> {{ hero.ctaButton.text }}
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </section>
    {% endif %}
    
    {# Featured Projects Section #}
    {% include "featured-projects.njk" %}
    
    <div class="home-content">
        {{ content | safe }}
    </div>

    {# Custom Sections with Tab Support #}
    {% if customSections %}
        {% for section in customSections %}
            <section class="custom-section {{ section.class or '' }}" id="{{ section.id }}">
                <div class="section-container">
                    {% if section.title %}
                        <h2 class="section-title">{{ section.title }}</h2>
                    {% endif %}
                    
                    {% if section.id == 'projects' %}
                        <div class="projects-tabs" aria-labelledby="projects-tabs-label">
                            <div class="tab-buttons" role="tablist" aria-label="Projects">
                                <button role="tab" aria-selected="true" aria-controls="sculptures" id="tab-sculptures" class="tab-button" data-tab="sculptures">Sculptures</button>
                                <button role="tab" aria-selected="false" aria-controls="installations" id="tab-installations" class="tab-button" data-tab="installations">Installations</button>
                                <button role="tab" aria-selected="false" aria-controls="performance" id="tab-performance" class="tab-button" data-tab="performance">Performance</button>
                                <button role="tab" aria-selected="false" aria-controls="paintings" id="tab-paintings" class="tab-button" data-tab="paintings">Paintings</button>
                            </div>
                            <div class="tab-content">
                                {% for category in ['sculptures', 'installations', 'performance', 'paintings'] %}
                                    <div id="{{ category }}" role="tabpanel" aria-labelledby="tab-{{ category }}" class="tab-pane {% if loop.first %}active{% endif %}" {% if not loop.first %}aria-hidden="true"{% endif %}>
                                        <div class="posts-grid">
                                            {% for post in collections[category] %}
                                                <article class="post-card" data-year="{{ post.data.date | date('YYYY') if post.data.date else '' }}" data-medium="{{ post.data.medium or '' }}" data-excerpt="{{ (post.data.description or (post.templateContent | excerpt(120))) | safe }}">
                                                    {# Determine which image to display: featuredImage or first image from images array #}
                                                    {% set displayImage = post.data.featuredImage %}
                                                    {% if not displayImage and post.data.images and post.data.images.length > 0 %}
                                                        {% set displayImage = post.data.images[0].src %}
                                                    {% endif %}
                                                    
                                                    {% if displayImage %}
                                                        <div class="post-card-image">
                                                            <a href="{{ post.url | url }}">
                                                                {# Determine image metadata for caption #}
                                                                {% set imageData = null %}
                                                                {% if post.data.images and post.data.images.length > 0 %}
                                                                  {# Find the image data matching the display image #}
                                                                  {% for img in post.data.images %}
                                                                    {% if img.src == displayImage %}
                                                                      {% set imageData = img %}
                                                                    {% endif %}
                                                                  {% endfor %}
                                                                {% endif %}
                                                                
                                                                {# Determine alt text: use image alt, or fallback to post title #}
                                                                {% set altText = post.data.title %}
                                                                {% if imageData and imageData.alt %}
                                                                  {% set altText = imageData.alt %}
                                                                {% elif post.data.featuredImageAlt %}
                                                                  {% set altText = post.data.featuredImageAlt %}
                                                                {% endif %}
                                                                
                                                                <img src="{{ displayImage | url }}" data-src="{{ displayImage | url }}" alt="{{ altText }}" loading="lazy">
                                                            </a>
                                                        </div>
                                                        
                                                        {# Use project-image-caption template with project title/year and image description/author #}
                                                        {% set projectTitle = post.data.title %}
                                                        {% set projectYear = post.data.date | date('YYYY') if post.data.date else '' %}
                                                        {% set imageDescription = imageData.description if imageData else '' %}
                                                        {% set imageAuthor = imageData.author if imageData else '' %}
                                                        {% set projectSlug = post.fileSlug %}
                                                        {% set context = "projects-tab-" + category %}
                                                        {% include "project-image-caption.njk" %}
                                                    {% endif %}
                                                    <div class="post-card-content">
                                                        <h3 class="post-card-title">
                                                            <a href="{{ post.url | url }}">{{ post.data.title }}</a>
                                                        </h3>
                                                        {% if post.data.description %}
                                                            <p class="post-card-description">{{ post.data.description }}</p>
                                                        {% endif %}
                                                    </div>
                                                </article>
                                            {% endfor %}
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    {% else %}
                        <div class="section-content">
                            {{ section.content | safe }}
                        </div>
                    {% endif %}
                </div>
            </section>
        {% endfor %}
    {% endif %}
</div>

{# Contact Modal Overlay #}
<div class="contact-modal-overlay" id="contactModal" style="display: none;">
    <div class="contact-modal-content">
        {# Header section with atelier info and location #}
        <div class="contact-modal-header">
            <div class="contact-atelier">
                ATELIER<br>
                MAAS & THOMMEN
            </div>
            <div class="contact-location">
                10997<br>
                BERLIN
            </div>
        </div>
        
        {# Main content section with message and email #}
        <div class="contact-modal-body">
            <div class="contact-message">
                For commissions, collaborations or bookings reach out to us.
            </div>
            <a href="mailto:m-e@maja-explosiv.com" class="contact-email">m-e@maja-explosiv.com</a>
            <div class="contact-modal-footer">
                (Click outside to close)
            </div>
        </div>
        
        {# Decorative plant image - bottom center #}
        <img src="{{ '/assets/images/contact-image.png' | url }}" alt="" class="contact-image-bottom" aria-hidden="true">
        
        {# Decorative plant image - right side faded #}
        <img src="{{ '/assets/images/contact-image.png' | url }}" alt="" class="contact-image-right" aria-hidden="true">
    </div>
</div>

{# Modal JavaScript #}
<script>
(function() {
    const modal = document.getElementById('contactModal');
    if (!modal) return;
    
    const overlay = modal;
    
    // Function to open modal
    window.openContactModal = function() {
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    };
    
    // Function to close modal
    window.closeContactModal = function() {
        modal.style.display = 'none';
        document.body.style.overflow = '';
    };
    
    // Close when clicking on overlay (not content)
    overlay.addEventListener('click', function(e) {
        if (e.target === overlay) {
            closeContactModal();
        }
    });
    
    // Close with Escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && modal.style.display === 'flex') {
            closeContactModal();
        }
    });
    
    // Attach to all contact links
    document.querySelectorAll('a[href="/contact/"], a[href="#contact"]').forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            openContactModal();
        });
    });
})();
</script>
