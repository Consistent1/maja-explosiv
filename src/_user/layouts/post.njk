---
layout: sidebar-layout.njk
---
{# 
  User override for post layout - ensures sidebar appears on all blog posts
  Automatically routes project posts to the project template for proper display
#}

{# Check if this is a project post by category or tags #}
{% set isProject = (category in ['sculptures', 'installations', 'performance', 'paintings']) 
                   or ('sculptures' in tags) 
                   or ('installations' in tags) 
                   or ('performance' in tags) 
                   or ('paintings' in tags) %}

{# If it's a project, use the project template markup and suppress page header #}
{% if isProject %}
    {% set showPageTitle = false %}
    <article class="project-page">
        {# Project Title - Large, prominent heading #}
        <header class="project-header">
            <h1 class="project-title">{{ title }}</h1>
        </header>

        {# Hero Image - Full-width featured image #}
        {# Determine which image to display: featuredImage or first image from images array #}
        {% set displayImage = featuredImage %}
        {% if not displayImage and images %}
            {% if images.length > 0 %}
                {% set displayImage = images[0].src %}
            {% endif %}
        {% endif %}
        
        {% if displayImage %}
            <div class="project-hero-image">
                <img src="{{ displayImage | url }}" alt="{{ featuredImageAlt or title }}" loading="eager">
            </div>
        {% endif %}

        {# Two-column layout: Description (left) + First two gallery images (right) #}
        {% if images and images.length > 1 %}
            <div class="project-intro-section">
                {# Left column: Project description #}
                <div class="project-description-column">
                    {{ content | safe }}
                </div>
                
                {# Right column: First two gallery images stacked vertically #}
                <div class="project-intro-images">
                    {% for i in range(0, 2) %}
                        {% if images[i] and images[i].src != displayImage %}
                            <div class="intro-image-item">
                                {# Determine alt text #}
                                {% set altText = title %}
                                {% if images[i].title %}
                                  {% set altText = images[i].title %}
                                {% endif %}
                                {% if images[i].alt %}
                                  {% set altText = images[i].alt %}
                                {% endif %}
                                
                                <img src="{{ images[i].src | url }}" alt="{{ altText }}" loading="lazy">
                                
                                {# Image caption #}
                                {% set imageTitle = images[i].title %}
                                {% set imageYear = '' %}
                                {% if images[i].date %}
                                  {% set imageYear = images[i].date | date('YYYY') %}
                                {% elif images[i].year %}
                                  {% set imageYear = images[i].year %}
                                {% endif %}
                                {% set imageDescription = images[i].description %}
                                {% set imageAuthor = images[i].author %}
                                {% set projectSlug = page.fileSlug %}
                                {% set imageIndex = i %}
                                
                                {% include "single-project-image-caption.njk" %}
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        {% else %}
            {# Fallback: No images or only one image - show description full-width #}
            <div class="project-content">
                {{ content | safe }}
            </div>
        {% endif %}

        {# Third image - Full width (if exists and not used as featured) #}
        {% if images and images.length > 2 %}
            {% set thirdImageIndex = 2 %}
            {# Find the actual 3rd image that's not the featured image #}
            {% set imageCounter = 0 %}
            {% for img in images %}
                {% if img.src != displayImage %}
                    {% if imageCounter == 2 %}
                        <div class="project-full-width-image">
                            {# Determine alt text #}
                            {% set altText = title %}
                            {% if img.title %}
                              {% set altText = img.title %}
                            {% endif %}
                            {% if img.alt %}
                              {% set altText = img.alt %}
                            {% endif %}
                            
                            <img src="{{ img.src | url }}" alt="{{ altText }}" loading="lazy">
                            
                            {# Image caption #}
                            {% set imageTitle = img.title %}
                            {% set imageYear = '' %}
                            {% if img.date %}
                              {% set imageYear = img.date | date('YYYY') %}
                            {% elif img.year %}
                              {% set imageYear = img.year %}
                            {% endif %}
                            {% set imageDescription = img.description %}
                            {% set imageAuthor = img.author %}
                            {% set projectSlug = page.fileSlug %}
                            {% set imageIndex = loop.index0 %}
                            
                            {% include "single-project-image-caption.njk" %}
                        </div>
                    {% endif %}
                    {% set imageCounter = imageCounter + 1 %}
                {% endif %}
            {% endfor %}
        {% endif %}

        {# Remaining images - Rows of 2-3 images, top-aligned #}
        {% if images and images.length > 3 %}
            <div class="project-gallery-rows">
                {% set imageCounter = 0 %}
                {% for img in images %}
                    {% if img.src != displayImage %}
                        {% if imageCounter >= 3 %}
                            <div class="gallery-row-item">
                                {# Determine alt text #}
                                {% set altText = title %}
                                {% if img.title %}
                                  {% set altText = img.title %}
                                {% endif %}
                                {% if img.alt %}
                                  {% set altText = img.alt %}
                                {% endif %}
                                
                                <img src="{{ img.src | url }}" alt="{{ altText }}" loading="lazy">
                                
                                {# Image caption #}
                                {% set imageTitle = img.title %}
                                {% set imageYear = '' %}
                                {% if img.date %}
                                  {% set imageYear = img.date | date('YYYY') %}
                                {% elif img.year %}
                                  {% set imageYear = img.year %}
                                {% endif %}
                                {% set imageDescription = img.description %}
                                {% set imageAuthor = img.author %}
                                {% set projectSlug = page.fileSlug %}
                                {% set imageIndex = loop.index0 %}
                                
                                {% include "single-project-image-caption.njk" %}
                            </div>
                        {% endif %}
                        {% set imageCounter = imageCounter + 1 %}
                    {% endif %}
                {% endfor %}
            </div>
        {% endif %}

        {# Media Gallery - Additional project images if available (legacy) #}
        {% if mediaGallery %}
            <div class="project-gallery-rows">
                {% for media in mediaGallery %}
                    <div class="gallery-row-item">
                        <img src="{{ media.url | url }}" alt="{{ media.caption or '' }}" loading="lazy">
                        {% if media.caption %}
                            <p class="gallery-caption">{{ media.caption }}</p>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </article>
{% else %}

<article class="post">
    <!-- Post Header -->
    <header class="post-header">
        {% if featuredImage %}
            <div class="post-featured-image">
                <img src="{{ featuredImage | url }}" alt="{{ featuredImageAlt or title }}" class="featured-image">
                {% if featuredImageCaption %}
                    <figcaption class="featured-image-caption">{{ featuredImageCaption }}</figcaption>
                {% endif %}
            </div>
        {% endif %}
        
        <div class="post-meta">
            {% if postCollections %}
                <div class="post-collections">
                    {% for collection in postCollections %}
                        {% set collectionData = collections.collectionData | find('name', collection) %}
                        <a href="{{ ('/collections/' + (collection | slug) + '/') | url }}" class="collection-tag"
                           {% if collectionData and collectionData.color %}style="--collection-color: {{ collectionData.color }}"{% endif %}>
                            {{ (collectionData and collectionData.displayName) or (collection | title) }}
                        </a>
                    {% endfor %}
                </div>
            {% endif %}
            
            {% if date %}
                <time class="post-date" datetime="{{ date | date('YYYY-MM-DD') }}">
                    {{ date | dateDisplay }}
                </time>
            {% endif %}
            
            {% if author %}
                <span class="post-author">By {{ author }}</span>
            {% endif %}
            
            {% if readingTime %}
                <span class="reading-time">{{ readingTime }} min read</span>
            {% endif %}
        </div>
    </header>

    <!-- Post Content -->
    <div class="post-content">
        {{ content | safe }}
    </div>

    <!-- Post Footer -->
    <footer class="post-footer">
        {% if tags %}
            <div class="post-tags">
                <h3>Tags</h3>
                <ul class="tag-list">
                    {% for tag in tags %}
                        {% if tag != "posts" %}
                            <li><a href="{{ ('/tags/' + (tag | slug) + '/') | url }}" class="tag">#{{ tag }}</a></li>
                        {% endif %}
                    {% endfor %}
                </ul>
            </div>
        {% endif %}
        
        {% if showSocialSharing %}
            <div class="social-sharing">
                <h3>Share this post</h3>
                <!-- Social sharing buttons would go here -->
            </div>
        {% endif %}
    </footer>
</article>

{% endif %}