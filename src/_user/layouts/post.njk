---
layout: sidebar-layout.njk
---
{# 
  User override for post layout - ensures sidebar appears on all blog posts
  Automatically routes project posts to the project template for proper display
#}

{# Check if this is a project post by category or tags #}
{% set isProject = (category in ['sculptures', 'installations', 'performance', 'paintings']) 
                   or ('sculptures' in tags) 
                   or ('installations' in tags) 
                   or ('performance' in tags) 
                   or ('paintings' in tags) %}

{# If it's a project, use the project template markup and suppress page header #}
{% if isProject %}
    {% set showPageTitle = false %}
    <article class="project-page">
        {# Project Title - Large, prominent heading #}
        <header class="project-header">
            <h1 class="project-title">{{ title }}</h1>
        </header>

        {# Hero Image - Full-width featured image #}
        {# Determine which image to display: featuredImage or first image from images array #}
        {% set displayImage = featuredImage %}
        {% if not displayImage and images %}
            {% if images.length > 0 %}
                {% set displayImage = images[0].src %}
            {% endif %}
        {% endif %}
        
        {% if displayImage %}
            <div class="project-hero-image">
                <img src="{{ displayImage | url }}" alt="{{ featuredImageAlt or title }}" loading="eager">
            </div>
        
            {# Metadata Section - Compact info below the image #}
            <div class="project-metadata">
                <div class="metadata-row">
                    <div class="metadata-left">
                        <div class="metadata-label">Title</div>
                        <div class="metadata-label">Description</div>
                        {% if author %}
                            <div class="metadata-label">Author</div>
                        {% endif %}
                    </div>
                    <div class="metadata-right">
                        {% if date %}
                            <div class="metadata-year">{{ date | date('YYYY') }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>
        {% endif %}

        {# Project Description - Main content area #}
        <div class="project-content">
            {{ content | safe }}
        </div>

        {# Project Images - Gallery from front matter #}
        {% if images %}
            <div class="project-gallery">
                {% for image in images %}
                    {# Skip the image if it's being used as the featured image #}
                    {% if image.src != displayImage %}
                        <div class="gallery-item">
                            {# Determine alt text: use image alt, or fallback to image title, or fallback to project title #}
                            {% set altText = title %}
                            {% if image.title %}
                              {% set altText = image.title %}
                            {% endif %}
                            {% if image.alt %}
                              {% set altText = image.alt %}
                            {% endif %}
                            
                            <img src="{{ image.src | url }}" alt="{{ altText }}" loading="lazy">
                            
                            {# Use single-project-image-caption template with image-specific title/year #}
                            {% set imageTitle = image.title %}
                            {% set imageYear = '' %}
                            {% if image.date %}
                              {% set imageYear = image.date | date('YYYY') %}
                            {% elif image.year %}
                              {% set imageYear = image.year %}
                            {% endif %}
                            {% set imageDescription = image.description %}
                            {% set imageAuthor = image.author %}
                            {% set projectSlug = page.fileSlug %}
                            {% set imageIndex = loop.index0 %}
                            
                            {% include "single-project-image-caption.njk" %}
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
        {% endif %}

        {# Media Gallery - Additional project images if available (legacy) #}
        {% if mediaGallery %}
            <div class="project-gallery">
                {% for media in mediaGallery %}
                    <div class="gallery-item">
                        <img src="{{ media.url | url }}" alt="{{ media.caption or '' }}" loading="lazy">
                        {% if media.caption %}
                            <p class="gallery-caption">{{ media.caption }}</p>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </article>
{% else %}

<article class="post">
    <!-- Post Header -->
    <header class="post-header">
        {% if featuredImage %}
            <div class="post-featured-image">
                <img src="{{ featuredImage | url }}" alt="{{ featuredImageAlt or title }}" class="featured-image">
                {% if featuredImageCaption %}
                    <figcaption class="featured-image-caption">{{ featuredImageCaption }}</figcaption>
                {% endif %}
            </div>
        {% endif %}
        
        <div class="post-meta">
            {% if postCollections %}
                <div class="post-collections">
                    {% for collection in postCollections %}
                        {% set collectionData = collections.collectionData | find('name', collection) %}
                        <a href="{{ ('/collections/' + (collection | slug) + '/') | url }}" class="collection-tag"
                           {% if collectionData and collectionData.color %}style="--collection-color: {{ collectionData.color }}"{% endif %}>
                            {{ (collectionData and collectionData.displayName) or (collection | title) }}
                        </a>
                    {% endfor %}
                </div>
            {% endif %}
            
            {% if date %}
                <time class="post-date" datetime="{{ date | date('YYYY-MM-DD') }}">
                    {{ date | dateDisplay }}
                </time>
            {% endif %}
            
            {% if author %}
                <span class="post-author">By {{ author }}</span>
            {% endif %}
            
            {% if readingTime %}
                <span class="reading-time">{{ readingTime }} min read</span>
            {% endif %}
        </div>
    </header>

    <!-- Post Content -->
    <div class="post-content">
        {{ content | safe }}
    </div>

    <!-- Post Footer -->
    <footer class="post-footer">
        {% if tags %}
            <div class="post-tags">
                <h3>Tags</h3>
                <ul class="tag-list">
                    {% for tag in tags %}
                        {% if tag != "posts" %}
                            <li><a href="{{ ('/tags/' + (tag | slug) + '/') | url }}" class="tag">#{{ tag }}</a></li>
                        {% endif %}
                    {% endfor %}
                </ul>
            </div>
        {% endif %}
        
        {% if showSocialSharing %}
            <div class="social-sharing">
                <h3>Share this post</h3>
                <!-- Social sharing buttons would go here -->
            </div>
        {% endif %}
    </footer>
</article>

{% endif %}